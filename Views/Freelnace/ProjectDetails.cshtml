@using FreelanceGo_MasterV2.Models;
@{ Layout = "_FreelnaceLayout"; ViewData["Title"] = "ProjectDetails"; }


@{  
   var ProjectDetails = ViewData["ProjectDetails"] as Project; 
   IEnumerable<Auction> Auction = ViewData["Auction"] as IEnumerable<Auction>; 
}
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<style>
.project{
    margin-top: 3rem;
    padding: 3rem;
    border: 1px solid red;
	border-color: #ccc;
	-webkit-box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.2);
}
.Auction{
    margin-top: 3rem;
    padding: 3rem;
    border: 1px solid red;
	border-color: #ccc;
	-webkit-box-shadow: 0px 2px 3px 0px rgba(0, 0, 0, 0.2);
}
</style>


<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <div class="project"> 
                <div class="row">
                    <div class="col-sm-12">
                        <h3>ชื่องาน: @ProjectDetails.ProjectName</h3>
                        <input type="hidden" id="Project_ID" value=@ProjectDetails.Project_ID />
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <h3>รายละเอียด @ProjectDetails.Description</h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <h3>ราคาเริ่มต้น: @ProjectDetails.Budget</h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <h3>ระยะเวลาในการทำงาน: @ProjectDetails.Timelength วัน</h3>
                    </div>
                </div>
                 <div class="row">
                    <div class="col-sm-12">
                        <h3>วันที่เริ่มประมูล: @Html.DisplayFor(modelItem => ProjectDetails.StartingDate)</h3>
                    </div>
                </div>
                 <div class="row">
                    <div class="col-sm-12">
                        <h3>วันที่สิ้นสุดการประมูล: @Html.DisplayFor(modelItem => ProjectDetails.EndDate)</h3>
                    </div>
                </div>
                 <div class="row">
                    <div class="col-sm-12">
                        <h3>วันที่หมดเวลาประกาศงาน: @Html.DisplayFor(modelItem => ProjectDetails.ProjectTimeOut)</h3>
                    </div>
                </div>
                 <div class="row">
                    <div class="col-sm-12">
                        <h3 id="Project_IDText">ความสามารถที่ต้องการ: </h3>
                    </div>
                </div>
                @if (@ProjectDetails.Employer != null) {
                    <div class="row">
                        <div class="col-sm-12">
                            <h3>ประกาศโดย: @ProjectDetails.Employer.FullName</h3>
                        </div>
                    </div>
                }
                else if (@ProjectDetails.Company != null) 
                {
                    <div class="row">
                        <div class="col-sm-12">
                            <h3>ประกาศโดย: @ProjectDetails.Company.Company_Name</h3>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="Auction"> 
                <div class="row">
                    <div class="col-sm-12">
                        <table id="AuctionTable" style="width:100%;">
							<thead>
                                <tr style="height: 5rem; background-color: #4e4d4d; color:  white;">
                                <th class="col-xs-5">ชื่อ</th>
                                <th class="col-xs-3 text-center">ราคา</th>
                                <th class="col-xs-3 text-center">ระยะเวลาในการทำงาน/วัน</th>
                                </tr>
							</thead>
							<tbody class="points_table_scrollbar">
							</tbody>
							</table>
                    </div>
                </div>
                <hr>
                <form>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                        <label for="inputEmail4">ราคา</label>
                        <input type="number" class="form-control" id="Price" placeholder="ราคา">
                        </div>
                        <div class="form-group col-md-6">
                        <label for="inputPassword4">ระยะเวลาในการทำงาน/วัน</label>
                        <input type="number" class="form-control" id="AuctionTime" placeholder="ระยะเวลาในการทำงาน/วัน">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 text-center">
                            <button id="btnAuctionTime" type="button" class="btn btn-primary">ประมูล</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
$().ready(function() {
    var Project_ID = $("#Project_ID").val();
    var Price = 0;
    var AuctionTime = 0;
    $("#Price").change(function() {
        Price = $("#Price").val();
    });
     $("#AuctionTime").change(function() {
        AuctionTime = $("#AuctionTime").val();
    });
    jQuery.ajax({
        type: "get",
        dataType: "json",
        url: "/Home/GetProjectSkill/"+ Project_ID,
        success: function (data) {
            console.log(data);
            $.each(data, function(key, data) {   
               /*var newOption = new Option(data.text = data.name, data.id = data.skill_ID, false, true);
               $('#skills').append(newOption).trigger('change');*/
               $("#Project_IDText").append(data.name + " | ");
            });
        },
        error: function (data) {
            alert("กรอกข้อมูลไม่ถูกต้อง");
        },
        }); //end ajax
        jQuery.ajax({
        type: "get",
        dataType: "json",
        url: "/Freelnace/GetProjectAuction/"+ Project_ID,
        success: function (data) {
            console.log(data);
            $.each(data, function(key, data) {   
               var row1 = $('<tr class="odd" style="height:5rem;">'+
                                    '<td class="col-xs-2"><a href="/Freelnace/ProfileDetailsFreelance/'+data.freelance_ID+'">'+data.fullName+'</a></td>'+
                                    '<td class="col-xs-3 text-center">'+ data.price +' บาท</td>'+
                                    '<td class="col-xs-3 text-center">'+ data.auctionTime +' วัน</td>'+
                            '</tr>');
               $("#AuctionTable").append(row1);
            });
        },
        error: function (data) {
            alert("กรอกข้อมูลไม่ถูกต้อง");
        },
        }); //end ajax
    
    $("#btnAuctionTime").click(function() {
        jQuery.ajax({
        type: "post",
        dataType: "json",
        url: "/Freelnace/SaveAuction/",
        data: {
            Price: Price,
            AuctionTime: AuctionTime,
            Project_ID: Project_ID,
        },
        success: function (data) {
            console.log(data);
            location.replace("http://localhost:5000/Freelnace/ProjectDetails/"+Project_ID);
        },
        error: function (data) {
            alert("กรอกข้อมูลไม่ถูกต้อง");
        },
        }); //end ajax
    });
});
</script>